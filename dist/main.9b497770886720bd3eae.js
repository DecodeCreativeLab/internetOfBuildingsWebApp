(()=>{var e={454:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>r});const r=o.p+"images/extension_white_24dp.svg"},572:e=>{"use strict";e.exports=JSON.parse('{"group":"Energy Exchange","icon":"image_id_in_shared_folder","proposal":{"description":"Flatten the energy curve, through some mitigation and production strategies","image":"image_id_in_shared_folder","video":"video_url"},"methodology":{"description":"Analyze the existing consumption pattern based on the land use distribution and building status and potential solar energy production on their roofs to apply new strategies for a new energy model to them.","image":"image_id_in_shared_folder","video":"video_url"},"challenge":{"description":"Imbalance between energy consumption and energy production at building level","image":"image_id_in_shared_folder","video":"video_url"},"layers":[{"name":"winter","sublayers":[{"name":"Energy_production","mapID":"internetofbuildings2021.8mjftbho","mapboxSrc":["Energy_group_Winter_afternoon-awhbre"],"type":"polygon","representation":"2D","source":"https://www.sedecatastro.gob.es","scale":"detailed","units":"kWh/day","description":"energy consumption&production per building 12am-17pm","interpolation":true,"paint":{"property":"Production","stops":[[5,"#fcf400"],[50,"#fcb900"],[100,"#fc2600"]]},"legend":[{"color":"#fcf400","stop":"5"},{"color":"#fcb900","stop":"50"},{"color":"#fc2600","stop":"100"}],"interactable":{"status":true,"text":"Scatterplot consumers-producers"},"icon":false},{"name":"Energy_consumption","mapID":"internetofbuildings2021.8mjftbho","mapboxSrc":["Energy_group_Winter_afternoon-awhbre"],"type":"polygon","representation":"2D","source":"https://www.sedecatastro.gob.es","scale":"detailed","units":"kWh/day","description":"energy consumption&production per building 12am-17pm","interpolation":true,"paint":{"property":"Consumption","stops":[[5,"#fcf400"],[50,"#fcb900"],[100,"#fc2600"]]},"legend":[{"color":"#fcf400","stop":"5"},{"color":"#fcb900","stop":"50"},{"color":"#fc2600","stop":"100"}],"interactable":{"status":false,"text":"Scatterplot consumers-producers"},"image":"false"},{"name":"Energy_commercial","mapID":"internetofbuildings2021.8mjftbho","mapboxSrc":["Energy_group_Winter_afternoon-awhbre"],"type":"polygon","representation":"2D","source":"https://www.sedecatastro.gob.es","scale":"detailed","units":"kWh/day","description":"energy consumption&production per building 12am-17pm","interpolation":true,"paint":{"property":"Commercial","stops":[[5,"#fcf400"],[50,"#fcb900"],[100,"#fc2600"]]},"legend":[{"color":"#fcf400","stop":"5"},{"color":"#fcb900","stop":"50"},{"color":"#fc2600","stop":"100"}],"interactable":{"status":false,"text":"Scatterplot consumers-producers"},"icon":false}]}]}')},18:e=>{"use strict";e.exports=JSON.parse('{"group":"group name","icon":"image_name_in_shared_folder","proposal":{"description":"text","image":"image_name_in_shared_folder","video":"video_url"},"methodology":{"description":"text","image":"image_name_in_shared_folder","video":"video_url"},"challenge":{"description":"text","image":"image_name_in_shared_folder","video":"video_url"},"layers":[{"name":"Land use","sublayers":[{"name":"Waterways","mapID":"mapbox.mapbox-streets-v8","mapboxSrc":["waterway"],"type":"lineString","representation":"2D","source":"https://www.openstreetmap.org","scale":"detailed","units":"N/A","description":"waterways from Open Street Map","interpolation":false,"paint":{"property":"type","stops":[["river","#2c003e"],["canal","#512b58"],["stream","#ffa372"],["ditch","#ea9085"],["drain","#34ebcc"]]},"legend":[{"color":"#2c003e","stop":"river"},{"color":"#512b58","stop":"canal"},{"color":"#ffa372","stop":"stream"},{"color":"#ea9085","stop":"ditch"},{"color":"#34ebcc","stop":"drain"}],"interactable":{"status":false,"text":"my_text_goes_here"},"icon":"extension_white_24dp.svg"},{"name":"Green space","mapID":"mapbox.mapbox-streets-v8","mapboxSrc":["landuse"],"type":"polygon","representation":"2D","source":"http://www.openstreetmap.org","scale":"detailed","units":"N/A","description":"Green space from OpenStreetMaps","interpolation":false,"paint":{"property":"class","stops":[["agriculture","#57ff8c"],["park","#2c003e"],["scrub","#caff57"],["wood","#47d1bf"]]},"legend":[{"color":"#57ff8c","stop":"agriculture"},{"color":"#2c003e","stop":"park"},{"color":"#caff57","stop":"scrub"},{"color":"#47d1bf","stop":"wood"}],"interactable":{"status":false,"text":"my_text_goes_here"},"icon":"extension_white_24dp.svg"}]},{"name":"Contours","mapID":"mapbox.mapbox-terrain-v2","mapboxSrc":["contour"],"type":"lineString","representation":"2D","source":"http://www.openstreetmap.org","scale":"detailed","units":"meters (m)","description":"Elevation contours from OpenStreetMaps","interpolation":true,"paint":{"property":"ele","stops":[[0,"#53e6de"],[50,"#53cbe6"],[100,"#53b0e6"],[500,"#5362e6"]]},"legend":[{"color":"#53e6de","stop":"0"},{"color":"#53cbe6","stop":"50 m"},{"color":"#53b0e6","stop":"100 m"},{"color":"#5362e6","stop":"500 m"}],"interactable":{"status":false,"text":"my_text_goes_here"},"icon":"extension_white_24dp.svg"}]}')},504:(e,t,o)=>{var r={"./Energy_exchange_edited.json":572,"./sampleFile.json":18};function n(e){var t=i(e);return o(t)}function i(e){if(!o.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=504},538:(e,t,o)=>{var r={"./extension_white_24dp.svg":454};function n(e){var t=i(e);return o(t)}function i(e){if(!o.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=538}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{"use strict";function e(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}const t=document.querySelector("#buttonLayerPanel"),r=document.querySelector("#buttonChallenge"),n=document.querySelector("#buttonMethodology"),i=document.querySelector("#buttonProposal"),a=document.getElementById("dataLayers"),l=document.getElementById("legend"),s=document.getElementById("data-layer-template"),c=document.querySelector("#legend-template");let p;const d=function(e){let t={};return e.keys().map(((o,r)=>{t[o.replace("./","")]=e(o)})),t}(o(538));function u(t){t.forEach((t=>{t.uuid=uuidv4(),function(t,o){const r=document.createElement("a");r.innerText=t,document.querySelector(".dropdown-content").appendChild(r),r.addEventListener("click",(()=>{m(),e(l),[...a.querySelectorAll(".cluster")].map((e=>e.classList.add("hidden"))),document.getElementById(o).classList.remove("hidden"),document.querySelector(".dropbtn").innerHTML=`${t}  <i class="fa fa-caret-down"></i>`}))}(t.group,t.uuid);const o=document.createElement("ul");o.id=t.uuid,o.classList.add("cluster"),o.classList.add("hidden"),a.appendChild(o),t.layers.forEach(((e,t)=>{if(e.uuid=uuidv4(),e.sublayers){let t=function(e,t){const o=s.content.cloneNode(!0);o.id=e.name+"-template";const r=o.querySelector("#layer-id");r.id=e.uuid;let n=o.getElementById("label");n.htmlFor=e.uuid,n.textContent=e.name.replace(/_/g," "),n.setAttribute("title",e.description);let i=o.querySelector("#layer-link");e.source?i.href=e.source:i.classList.add("hidden");let a=document.createElement("ul");return a.classList.add("sublayers"),a.classList.add("hidden"),o.querySelector("li").appendChild(a),t.appendChild(o),r.addEventListener("click",(()=>{r.checked?a.classList.remove("hidden"):a.classList.add("hidden")})),a}(e,o);e.sublayers.forEach((e=>{e.uuid=uuidv4(),y(e,t)}))}else y(e,o)}))}))}function y(t,o){const r=s.content.cloneNode(!0);r.id=t.name+"-template";const n=r.querySelector("#layer-id");n.classList.add("map-layer"),n.id=t.uuid;let i=r.getElementById("label");i.htmlFor=t.uuid,i.textContent=t.name.replace(/_/g," "),i.setAttribute("title",t.description);let a=r.querySelector("#layer-link");t?a.href=t.source:a.classList.add("hidden"),o.appendChild(r),n.addEventListener("click",(function(){m(),"false"==n.getAttribute("initialise")&&("raster"==t.type?function(e,t="none"){for(var o,r=_.getStyle().layers,n=0;n<r.length;n++)if("symbol"===r[n].type&&r[n].layout["text-field"]){o=r[n].id;break}_.addLayer({id:e.uuid,source:{type:"raster",url:"mapbox://"+e.mapID},type:"raster",layout:{visibility:t}},o)}(t):"point"==t.type?function(e,t="none"){for(var o,r=_.getStyle().layers,n=0;n<r.length;n++)if("symbol"===r[n].type&&r[n].layout["text-field"]){o=r[n].id;break}switch(e.type){case"point":let r=["match",["get",e.paint.property]];for(let t of e.paint.stops)r.push(t[0]),r.push(t[1]);r.push("#ccc"),_.addLayer({id:e.uuid,source:{type:"vector",url:"mapbox://"+e.mapID},type:"circle","source-layer":e.mapboxSrc[0],layout:{visibility:t},paint:{"circle-radius":{base:1.75,stops:[[6,2],[8,10],[22,180]]},"circle-color":r}},o),e.interactable&&(i=e,_.on("click",i.name,(function(e){let t=_.queryRenderedFeatures(e.point),o=document.createElement("div");for(let e in t[0].properties){let r=document.createElement("p");r.classList.add("black-text"),r.innerText=e+" : "+t[0].properties[e],o.appendChild(r)}for(;Math.abs(e.lngLat.lng-g[0])>180;)g[0]+=e.lngLat.lng>g[0]?360:-360;(new mapboxgl.Popup).setLngLat(e.lngLat).setHTML("DATA").addTo(_)._content.appendChild(o)})),_.on("mouseenter",id,(function(){_.getCanvas().style.cursor="pointer"})),_.on("mouseleave",id,(function(){_.getCanvas().style.cursor=""})));break;case"heatmap":_.addLayer({id:e.uuid,type:"heatmap",source:{type:"vector",url:"mapbox://"+e.mapID},"source-layer":e.mapboxSrc[0],paint:{"heatmap-color":e.paint.colours,"heatmap-radius":e.paint.radius},layout:{visibility:t}},o)}var i}(t):"polygon"==t.type?L(t):"lineString"==t.type&&function(e,t="none"){for(var o,r=_.getStyle().layers,n=0;n<r.length;n++)if("symbol"===r[n].type&&r[n].layout["text-field"]){o=r[n].id;break}let i={"line-width":3,"line-color":[]};if(e.interpolation){i["line-color"]=["interpolate",["linear"],["get",e.paint.property]];for(let t of e.paint.stops)i["line-color"].push(t[0]),i["line-color"].push(["to-color",t[1]])}else{i["line-color"]=["match",["get",e.paint.property]];for(let t of e.paint.stops)i["line-color"].push(t[0]),i["line-color"].push(t[1]);i["line-color"].push("#ccc")}_.addLayer({id:e.uuid,type:"line",source:{type:"vector",url:"mapbox://"+e.mapID},"source-layer":e.mapboxSrc[0],layout:{visibility:t,"line-join":"round","line-cap":"round"},paint:i},o)}(t),n.setAttribute("initialise","true")),"on"==n.getAttribute("state")?(!function(e){_.setLayoutProperty(e,"visibility","none")}(n.id),n.setAttribute("state","off"),e(l)):(function(e){_.setLayoutProperty(e,"visibility","visible");let t=h.find((t=>t.uuid==e));t&&function(e){switch(e.scale){case"detailed":_.flyTo({zoom:16,speed:.4});break;case"large":_.flyTo({zoom:12,speed:.4})}}(t)}(n.id),p=n.id,n.setAttribute("state","on"),function(t){e(l);let o=c.content.cloneNode(!0);t.icon?o.querySelector("#icon").src=`images/${t.icon}`:o.querySelector("#icon").classList.add("hidden");o.querySelector("#layer-name").innerText=t.name,o.querySelector("#layer-description").innerText=t.description,o.querySelector("#units").innerText=t.units,"N/A"==t.units&&o.querySelector("#units").classList.add("hidden");let r="";t.legend.forEach(((e,o)=>{o>0&&t.interpolation?r+=`${t.legend[o-1].color} ${parseFloat(t.legend[o-1].stop)}%, ${e.color} ${parseFloat(e.stop)}%, `:r+=`${e.color} ${e.stop}%, `})),o.querySelector(".gradient").style.background=`linear-gradient(to right, ${r.slice(0,-2)})`,console.log(`linear-gradient(to right, ${r.slice(0,-2)})`),o.querySelector("#min").innerText=t.legend[0].stop,o.querySelector("#max").innerText=t.legend[t.legend.length-1].stop,l.appendChild(o)}(t))}))}function m(){let e=[...document.querySelectorAll(".map-layer")];for(let t of e)t&&t.checked&&t.click()}function f(){[...document.querySelectorAll(".overlay")].map((e=>e.classList.add("hidden")))}console.log(d),t.addEventListener("click",(function(){a.classList.toggle("hidden")})),n.addEventListener("click",(function(){f(),document.querySelector("#methodology-overlay").classList.remove("hidden")})),r.addEventListener("click",(function(){f(),document.querySelector("#challenge-overlay").classList.remove("hidden")})),i.addEventListener("click",(function(){f(),document.querySelector("#proposal-overlay").classList.remove("hidden")})),[...document.querySelectorAll("#close-overlay")].map((e=>{e.addEventListener("click",(()=>{e.parentElement.classList.add("hidden")}))}));const g=document.getElementById("coordinates");let h="",b=0,v=0;const x={name:"3D_Buildings",mapID:"mapbox.mapbox-streets-v8",mapboxSrc:["building"],type:"polygon",representation:"3D",interpolation:!1,paint:{property:"height",stops:[[100,"#4a4a4a"]],"extrusion-height":"height","extrusion-opacity":1},uuid:uuidv4()};mapboxgl.accessToken="pk.eyJ1IjoiaW50ZXJuZXRvZmJ1aWxkaW5nczIwMjEiLCJhIjoiY2twNnk2dHI2MnYwODJybWNtOGdtNTV5dSJ9.P4wsBRwXAI9yQt9nd0GVlg";var _=new mapboxgl.Map({container:"map",style:"mapbox://styles/internetofbuildings2021/ckpedknie05ji18o0vu8z2tna",center:[2.20432,41.40028],zoom:15,preserveDrawingBuffer:!0,language:"en-EN",attributionControl:!1});_.addControl(new mapboxgl.ScaleControl,"bottom-right"),_.addControl(new mapboxgl.NavigationControl),_.addControl(new mapboxgl.AttributionControl({compact:!0})),_.on("load",(function(){_.resize(),_.addSource("single-point",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),_.setLayoutProperty("country-label","text-field",["get","name_en"]),_.setLayoutProperty("state-label","text-field",["get","name_en"]),L(x,"visible")})),_.on("mousemove",(function(e){0}));var w,S;new MapboxDraw({displayControlsDefault:!1,controls:{polygon:!0,trash:!1}});function L(e,t="none"){for(var o,r=_.getStyle().layers,n=0;n<r.length;n++)if("symbol"===r[n].type&&r[n].layout["text-field"]){o=r[n].id;break}switch(e.representation){case"2D":let r={"fill-opacity":e.paint.opacity?e.paint.opacity:1};if(e.interpolation){r["fill-color"]=["interpolate",["linear"],["get",e.paint.property]];for(let t of e.paint.stops)r["fill-color"].push(t[0]),r["fill-color"].push(["to-color",t[1]])}else{r["fill-color"]=["match",["get",e.paint.property]];for(let t of e.paint.stops)r["fill-color"].push(t[0]),r["fill-color"].push(t[1]);r["fill-color"].push("#ccc")}_.addLayer({id:e.uuid,source:{type:"vector",url:"mapbox://"+e.mapID},"source-layer":e.mapboxSrc[0],type:"fill",layout:{visibility:t},paint:r},o);break;case"3D":let n={"fill-extrusion-height":["get",e.paint["extrusion-height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],8,0,10.05,1],"fill-extrusion-opacity":e.paint["extrusion-opacity"]};if(e.interpolation){n["fill-extrusion-color"]=["interpolate",["linear"],["get",e.paint.property]];for(let t of e.paint.stops)n["fill-extrusion-color"].push(t[0]),n["fill-extrusion-color"].push(["to-color",t[1]])}else{n["fill-extrusion-color"]={property:e.paint.property,stops:[]};for(let t of e.paint.stops)n["fill-extrusion-color"].stops.push([t[0],t[1]])}_.addLayer({id:e.uuid,source:{type:"vector",url:"mapbox://"+e.mapID},"source-layer":e.mapboxSrc[0],filter:["==","extrude","true"],type:"fill-extrusion",layout:{visibility:t},paint:n},o)}}document.onmousemove=function(e){e=e||window.event,b=e.clientX,v=e.clientY},w=[],(S=o(504)).keys().forEach((e=>{w.push(S(e))})),h=w,u(h)})()})();